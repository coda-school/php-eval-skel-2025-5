{% extends 'base.html.twig' %}

{% block title %}Swiffer - Fil d'actualité{% endblock %}

{% block body %}
    <div class="tweet-box">
        <form method="post">
            <textarea
                id="tweet_content"
                name="content"
                rows="3"
                placeholder="Quoi de neuf ?"
                maxlength="280"
                required
            ></textarea>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                <small id="char-count" style="color: var(--muted);">0 / 280</small>
                <button type="submit" class="tweet-btn" style="width: 120px;">Poster</button>
            </div>
        </form>
    </div>

    <div id="tweets-feed">
        {% for tweet in tweets %}
            <div class="post">
                <strong>@{{ tweet.author.username }}</strong>
                <p>{{ tweet.content }}</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                    <small style="color: var(--muted);">{{ tweet.createdAt|date('d/m H:i') }}</small>

                    {% if app.user and tweet.author == app.user %}
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <a href="{{ path('app_tweet_edit', {'id': tweet.id}) }}" style="color: var(--primary); text-decoration: none;">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </a>

                            <form method="post" action="{{ path('app_tweet_delete', {'id': tweet.id}) }}" onsubmit="return confirm('Supprimer ce tweet ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ tweet.id) }}">
                                <button type="submit" style="background:none; border:none; color:#ef4444; cursor:pointer; padding:0;">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="post">
                <p>Aucun tweet trouvé. Ton fil d'actualité est bien vide !</p>
            </div>
        {% endfor %}
    </div>

    <script>
        const textarea = document.getElementById('tweet_content');
        const counter = document.getElementById('char-count');

        textarea.addEventListener('input', () => {
            const count = textarea.value.length;
            counter.textContent = `${count} / 280`;

            if (count >= 280) {
                counter.style.color = "#ef4444";
            } else if (count >= 250) {
                counter.style.color = "#f59e0b";
            } else {
                counter.style.color = "var(--muted)";
            }
        });
    </script>
{% endblock %}
